# LibreWatermark

一个简单的纯 JavaScript 前端工具，用于在文本中嵌入和提取基于零宽字符的盲水印。

## 功能

*   **嵌入水印**: 使用用户提供的密钥（密码）和水印内容，将水印信息（经过混淆和认证码附加）通过零宽字符嵌入到原始文本中。支持分块嵌入以提高部分复制时的提取成功率。
*   **提取水印**: 使用相同的密钥，从包含水印的文本中扫描所有零宽字符，尝试解码潜在的水印信息，并通过认证码严格验证密钥和数据的正确性。
*   **密钥保护**: 提取水印**必须**使用与嵌入时使用的相同的密钥。认证码机制大大增强了这一安全性。
*   **密度控制**: 用户可以控制水印的分块大小，从而影响水印的嵌入密度和部分提取的鲁棒性。
*   **纯前端**: 无需后端，完全在浏览器中运行。
*   **易于部署**: 可以轻松部署到任何静态网站托管平台，如 Cloudflare Pages, Vercel, GitHub Pages 等。

## 如何使用

1.  将此项目文件部署到您的静态托管平台 (Cloudflare Pages, Vercel, GitHub Pages 等)。
2.  或者，直接在本地用浏览器打开 `index.html` 文件。
3.  在界面上选择“嵌入水印”或“提取水印”。
4.  **嵌入水印**:
    *   输入用于保护水印的**密钥**（重要！）。
    *   输入要嵌入的**水印内容**。
    *   输入您的**原始文本**。
    *   调整**分块大小**滑块（值越小，水印在文本中重复的次数越多，密度越高，越容易从短片段中提取，但文本膨胀越大）。
    *   点击“生成带水印的文本”，结果将出现在下方。
    *   点击“复制结果”按钮。
5.  **提取水印**:
    *   输入嵌入时使用的**相同密钥**（重要！）。
    *   粘贴可能包含水印的**文本**。
    *   点击“尝试提取水印”，结果将显示在下方。如果密钥正确且文本包含未被破坏的水印，将显示水印内容；否则会提示失败。

## 注意事项

*   **脆弱性**: 零宽字符水印可能会被某些文本编辑器、社交媒体平台或内容管理系统（如微信公众号、知乎）自动过滤或清除，导致水印失效。
*   **非抗洗稿**: 此方法主要用于追踪直接复制粘贴或轻微修改后的文本，**无法**有效对抗语义层面上的“洗稿”行为。
*   **密钥安全**: 请使用足够强度的密钥，并妥善保管。密钥的丢失将导致无法提取水印，密钥的泄露将威胁水印的私密性。
*   **字符编码**: 水印内容默认使用 UTF-8 编码。
*   **性能**: 对于极长的文本和极高的密度（非常小的分块大小），嵌入和提取过程可能会消耗较多浏览器资源。

## 部署到 Cloudflare Pages

1.  将此项目文件上传到您的 GitHub (或其他支持的 Git 提供商) 仓库。
2.  登录 Cloudflare Dashboard。
3.  导航到 Workers & Pages > Create application > Pages > Connect to Git。
4.  选择您的仓库。
5.  在 "Build settings" 中，通常无需配置构建命令和输出目录（因为是静态文件），直接点击 "Save and Deploy"。
6.  Cloudflare 将自动部署您的站点。

## 技术实现细节

*   使用零宽度空格 (\u200b) 和零宽度非连接符 (\u200c) 分别代表二进制位 '0' 和 '1'。
*   水印内容被转换为 UTF-8 二进制序列。
*   水印二进制数据包含一个 16 位的长度前缀，以及一个基于密钥和水印内容的 16 位认证码。
*   使用密钥派生的伪随机数生成器 (PRNG) 来生成 Keystream，用于混淆（XOR 加密）水印的二进制 payload。
*   使用密钥和块索引派生的 PRNG 来确定在文本块中嵌入水印零宽字符的精确位置。
*   提取时，扫描所有零宽字符，尝试从任意位置开始按 payload 结构（长度+数据+认证码）进行解码，并通过重新计算并比较认证码来验证密钥和数据的正确性。
